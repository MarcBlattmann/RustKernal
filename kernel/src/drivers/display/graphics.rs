//! Graphics primitives for GUI rendering

use crate::drivers::display::Screen;

/// Color constants - simple black and white style
pub const COLOR_WHITE: u32 = 0xFFFFFFFF;
pub const COLOR_BLACK: u32 = 0xFF000000;
pub const COLOR_GRAY: u32 = 0xFF808080;
pub const COLOR_DARK_GRAY: u32 = 0xFF000000;  // Black
pub const COLOR_LIGHT_GRAY: u32 = 0xFFFFFFFF; // White
pub const COLOR_BLUE: u32 = 0xFF000000;       // Black
pub const COLOR_DARK_BLUE: u32 = 0xFF000000;  // Black
pub const COLOR_RED: u32 = 0xFF000000;        // Black
pub const COLOR_GREEN: u32 = 0xFF000000;      // Black
pub const COLOR_TITLE_BAR: u32 = 0xFF000000;  // Black
pub const COLOR_TITLE_BAR_INACTIVE: u32 = 0xFF808080; // Gray
pub const COLOR_DESKTOP: u32 = 0xFFFFFFFF;    // White background
pub const COLOR_TASKBAR: u32 = 0xFF000000;    // Black

impl Screen {
    /// Draw a filled rectangle
    pub fn draw_rect(&mut self, x: i32, y: i32, width: u32, height: u32, color: u32) {
        let x_start = x.max(0) as usize;
        let y_start = y.max(0) as usize;
        let x_end = ((x + width as i32) as usize).min(self.width);
        let y_end = ((y + height as i32) as usize).min(self.height);

        for py in y_start..y_end {
            for px in x_start..x_end {
                self.write_pixel(px, py, color);
            }
        }
    }

    /// Draw a rectangle outline
    pub fn draw_rect_outline(&mut self, x: i32, y: i32, width: u32, height: u32, color: u32, thickness: u32) {
        // Top
        self.draw_rect(x, y, width, thickness, color);
        // Bottom
        self.draw_rect(x, y + height as i32 - thickness as i32, width, thickness, color);
        // Left
        self.draw_rect(x, y, thickness, height, color);
        // Right
        self.draw_rect(x + width as i32 - thickness as i32, y, thickness, height, color);
    }

    /// Draw a horizontal line
    pub fn draw_hline(&mut self, x: i32, y: i32, width: u32, color: u32) {
        self.draw_rect(x, y, width, 1, color);
    }

    /// Draw a vertical line
    pub fn draw_vline(&mut self, x: i32, y: i32, height: u32, color: u32) {
        self.draw_rect(x, y, 1, height, color);
    }

    /// Draw text at position
    pub fn draw_text(&mut self, x: i32, y: i32, text: &str, color: u32) {
        let mut cx = x;
        for c in text.chars() {
            if cx >= 0 && cx < self.width as i32 - 8 && y >= 0 && y < self.height as i32 - 8 {
                self.draw_char(cx as usize, y as usize, c, color);
            }
            cx += 8;
        }
    }

    /// Draw a single character
    fn draw_char(&mut self, x: usize, y: usize, c: char, color: u32) {
        let font = get_char_bitmap(c);
        for (row, &bits) in font.iter().enumerate() {
            for col in 0..8usize {
                if bits & (0x80 >> col) != 0 {
                    self.write_pixel(x + col, y + row, color);
                }
            }
        }
    }

    /// Draw mouse cursor - solid white arrow
    pub fn draw_cursor(&mut self, x: i32, y: i32) {
        // Simple white arrow cursor
        let cursor = [
            0b10000000u8,
            0b11000000u8,
            0b11100000u8,
            0b11110000u8,
            0b11111000u8,
            0b11111100u8,
            0b11111110u8,
            0b11111111u8,
            0b11111000u8,
            0b11011000u8,
            0b10001100u8,
            0b00001100u8,
            0b00000110u8,
            0b00000110u8,
            0b00000000u8,
            0b00000000u8,
        ];

        for (row, &bits) in cursor.iter().enumerate() {
            for col in 0..8 {
                if bits & (0x80 >> col) != 0 {
                    let px = x + col as i32;
                    let py = y + row as i32;
                    if px >= 0 && px < self.width as i32 && py >= 0 && py < self.height as i32 {
                        self.write_pixel(px as usize, py as usize, COLOR_WHITE);
                    }
                }
            }
        }
    }

    /// Draw a 3D-style button
    pub fn draw_button(&mut self, x: i32, y: i32, width: u32, height: u32, text: &str, pressed: bool) {
        if pressed {
            self.draw_rect(x, y, width, height, COLOR_DARK_GRAY);
            self.draw_hline(x, y, width, COLOR_BLACK);
            self.draw_vline(x, y, height, COLOR_BLACK);
        } else {
            self.draw_rect(x, y, width, height, COLOR_LIGHT_GRAY);
            self.draw_hline(x, y, width, COLOR_WHITE);
            self.draw_vline(x, y, height, COLOR_WHITE);
            self.draw_hline(x, y + height as i32 - 1, width, COLOR_DARK_GRAY);
            self.draw_vline(x + width as i32 - 1, y, height, COLOR_DARK_GRAY);
        }
        
        // Center text
        let text_x = x + (width as i32 - text.len() as i32 * 8) / 2;
        let text_y = y + (height as i32 - 8) / 2;
        self.draw_text(text_x, text_y, text, COLOR_BLACK);
    }
}

/// Simple 8x8 font bitmap lookup
fn get_char_bitmap(c: char) -> [u8; 8] {
    match c {
        'A' => [0x18, 0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x00],
        'B' => [0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00],
        'C' => [0x3C, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00],
        'D' => [0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00],
        'E' => [0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x7E, 0x00],
        'F' => [0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x00],
        'G' => [0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3C, 0x00],
        'H' => [0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00],
        'I' => [0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00],
        'J' => [0x1E, 0x0C, 0x0C, 0x0C, 0x6C, 0x6C, 0x38, 0x00],
        'K' => [0x66, 0x6C, 0x78, 0x70, 0x78, 0x6C, 0x66, 0x00],
        'L' => [0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00],
        'M' => [0x63, 0x77, 0x7F, 0x6B, 0x63, 0x63, 0x63, 0x00],
        'N' => [0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x00],
        'O' => [0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00],
        'P' => [0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00],
        'Q' => [0x3C, 0x66, 0x66, 0x66, 0x6A, 0x6C, 0x36, 0x00],
        'R' => [0x7C, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0x66, 0x00],
        'S' => [0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00],
        'T' => [0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00],
        'U' => [0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00],
        'V' => [0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00],
        'W' => [0x63, 0x63, 0x63, 0x6B, 0x7F, 0x77, 0x63, 0x00],
        'X' => [0x66, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x66, 0x00],
        'Y' => [0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00],
        'Z' => [0x7E, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x7E, 0x00],
        'a' => [0x00, 0x00, 0x3C, 0x06, 0x3E, 0x66, 0x3E, 0x00],
        'b' => [0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x00],
        'c' => [0x00, 0x00, 0x3C, 0x66, 0x60, 0x66, 0x3C, 0x00],
        'd' => [0x06, 0x06, 0x3E, 0x66, 0x66, 0x66, 0x3E, 0x00],
        'e' => [0x00, 0x00, 0x3C, 0x66, 0x7E, 0x60, 0x3C, 0x00],
        'f' => [0x1C, 0x36, 0x30, 0x7C, 0x30, 0x30, 0x30, 0x00],
        'g' => [0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x3C],
        'h' => [0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00],
        'i' => [0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x3C, 0x00],
        'j' => [0x0C, 0x00, 0x1C, 0x0C, 0x0C, 0x6C, 0x6C, 0x38],
        'k' => [0x60, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0x00],
        'l' => [0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00],
        'm' => [0x00, 0x00, 0x66, 0x7F, 0x7F, 0x6B, 0x63, 0x00],
        'n' => [0x00, 0x00, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00],
        'o' => [0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x00],
        'p' => [0x00, 0x00, 0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60],
        'q' => [0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x06],
        'r' => [0x00, 0x00, 0x7C, 0x66, 0x60, 0x60, 0x60, 0x00],
        's' => [0x00, 0x00, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x00],
        't' => [0x30, 0x30, 0x7C, 0x30, 0x30, 0x36, 0x1C, 0x00],
        'u' => [0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x00],
        'v' => [0x00, 0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00],
        'w' => [0x00, 0x00, 0x63, 0x6B, 0x7F, 0x7F, 0x36, 0x00],
        'x' => [0x00, 0x00, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x00],
        'y' => [0x00, 0x00, 0x66, 0x66, 0x66, 0x3E, 0x06, 0x3C],
        'z' => [0x00, 0x00, 0x7E, 0x0C, 0x18, 0x30, 0x7E, 0x00],
        '0' => [0x3C, 0x66, 0x6E, 0x7E, 0x76, 0x66, 0x3C, 0x00],
        '1' => [0x18, 0x38, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00],
        '2' => [0x3C, 0x66, 0x06, 0x0C, 0x18, 0x30, 0x7E, 0x00],
        '3' => [0x3C, 0x66, 0x06, 0x1C, 0x06, 0x66, 0x3C, 0x00],
        '4' => [0x0C, 0x1C, 0x3C, 0x6C, 0x7E, 0x0C, 0x0C, 0x00],
        '5' => [0x7E, 0x60, 0x7C, 0x06, 0x06, 0x66, 0x3C, 0x00],
        '6' => [0x1C, 0x30, 0x60, 0x7C, 0x66, 0x66, 0x3C, 0x00],
        '7' => [0x7E, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00],
        '8' => [0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x3C, 0x00],
        '9' => [0x3C, 0x66, 0x66, 0x3E, 0x06, 0x0C, 0x38, 0x00],
        ' ' => [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
        '.' => [0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00],
        ',' => [0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30],
        ':' => [0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x00],
        ';' => [0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x30],
        '!' => [0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x00],
        '?' => [0x3C, 0x66, 0x06, 0x0C, 0x18, 0x00, 0x18, 0x00],
        '-' => [0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00],
        '+' => [0x00, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x00, 0x00],
        '=' => [0x00, 0x00, 0x7E, 0x00, 0x7E, 0x00, 0x00, 0x00],
        '/' => [0x06, 0x0C, 0x18, 0x30, 0x60, 0x40, 0x00, 0x00],
        '\\' => [0x40, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x00, 0x00],
        '(' => [0x0C, 0x18, 0x30, 0x30, 0x30, 0x18, 0x0C, 0x00],
        ')' => [0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x18, 0x30, 0x00],
        '[' => [0x3C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3C, 0x00],
        ']' => [0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3C, 0x00],
        '<' => [0x00, 0x0C, 0x18, 0x30, 0x18, 0x0C, 0x00, 0x00],
        '>' => [0x00, 0x30, 0x18, 0x0C, 0x18, 0x30, 0x00, 0x00],
        '*' => [0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00],
        '%' => [0x62, 0x64, 0x08, 0x10, 0x26, 0x46, 0x00, 0x00],
        _ => [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
    }
}
